const mapDataMembers = [
  "luong",
  "long",
  "nam",
  "sum",
  "tram",
  "han",
  "dung",
  "nghia",
  "phat",
  "quang",
  "tuan",
];

const dataDocument = [
  {
    nameFolder: "Tuần 1",
    linkFolder:
      "https://drive.google.com/drive/folders/1netCg2zDrz4Q05UxgFUn4L_RIjyo5GE2",
    files: [
      {
        link: "https://drive.google.com/file/d/1CZEmdV4nx3xL4F2ILkZFtZ9yTWZ8X_3q/preview",
        nameFile: "link github",
        type: "txt",
        date: "27/07/21",
        creators: ["quang", "phat"],
      },
      {
        link: "https://drive.google.com/file/d/1zwm6Ownkz3gs2ZTgRR1X0C5vRhFTBsiS/preview",
        nameFile: "link youtube",
        type: "txt",
        date: "31/07/21",
        creators: ["nghia", "dung"],
      },
      {
        link: "https://drive.google.com/file/d/1D2SMZhCEOtCVzdoTclHoYXgeywtmZ-JJ/preview",
        nameFile: "Video slide",
        type: "mp4",
        date: "31/07/21",
        creators: ["dung", "nghia"],
      },
      {
        link: "https://drive.google.com/file/d/1YXwT6B8TvrojCPkH8VDRb6Dhk21mQ8gP/preview",
        nameFile: "Video Intro",
        type: "mp4",
        date: "31/07/21",
        creators: ["nghia", "dung"],
      },
      {
        link: "https://docs.google.com/spreadsheets/d/1IJ3Yq8ovA6PbwHJk57BmIQWDvBhoETsj27r7a17dbBo/preview",
        nameFile: "Intro khảo sát",
        type: "xlsx",
        date: "27/07/21",
        creators: ["dung", "nghia"],
      },
      {
        link: "https://docs.google.com/document/d/1VhDVdujk4gSZ90o1BGl4s4JP7XFooq3um9EiuWsrYdM/preview",
        nameFile: "Long - Kịch bản",
        type: "doc",
        date: "30/07/21",
        creators: ["long"],
      },
      {
        link: "https://docs.google.com/document/d/1rqdu6ydkDDUFe_cxpayu7hSeJ3q2-dg4I21xX8PLeC8/preview",
        nameFile: "Kịch bản - Trâm - ver1",
        type: "doc",
        date: "30/07/21",
        creators: ["tram"],
      },
      {
        link: "https://docs.google.com/document/d/1eDjc3fUQ0NzaNVmaEWftOB_3b-x0LLJtPzdXV7GNjNg/preview",
        nameFile: "Kịch bản-Sum-ver1",
        type: "doc",
        date: "29/07/21",
        creators: ["sum"],
      },
      {
        link: "https://docs.google.com/document/d/1v36xNmPR0n0ysp5VEvKP0YgBpKEXngtQhICruDJP6mU/preview",
        nameFile: "Kịch bản-Nam-ver1",
        type: "doc",
        date: "29/07/21",
        creators: ["nam"],
      },
      {
        link: "https://docs.google.com/document/d/1kRU3jVONRUPNjKn3LUCfstH0WCfe36I2oCkt_yI9YkM/preview",
        nameFile: "BBHP_26/07/2021",
        type: "doc",
        date: "26/07/21",
        creators: ["luong", "han", "long"],
      },
      {
        link: "https://drive.google.com/file/d/1cTrNNSlo5w6mPDTkZf0pEvFIrcp1xzFN/preview",
        nameFile: "BBHP_26_07_2021 [ver1]",
        type: "pdf",
        date: "29/07/21",
        creators: ["han", "luong"],
      },
      {
        link: "https://drive.google.com/file/d/14WJYWxXjZV1RTFO9pnOHf_sZLu-P7V9p/preview",
        nameFile: "BBHP_26/07/2021[ver2]",
        type: "pdf",
        date: "29/07/21",
        creators: ["han", "luong"],
      },
    ],
  },

  {
    nameFolder: "Tuần 2",
    linkFolder:
      "https://drive.google.com/drive/folders/1a6QO5gKlphsbYS4_BRqvWUifPDdKoBLf",
    files: [
      {
        link: "https://drive.google.com/file/d/12pnHYMZYqYPFYNOfqrjcGWgDL-kOUDrM/preview",
        nameFile: "link-web",
        type: "txt",
        date: "08/08/21",
        creators: ["quang", "phat"],
      },
      {
        link: "https://drive.google.com/file/d/1uENFyk2jDCty_fie1hrKVt98EdBr-AAm/preview",
        nameFile: "Phân cảnh quay",
        type: "pdf",
        date: "01/08/21",
        creators: ["long", "tram"],
      },
      {
        link: "https://docs.google.com/document/d/1gYqWhrqGUU8V5tH9irvpVALrhlV6J08clDqlfiR4Ouc/preview",
        nameFile: "Phân cảnh quay",
        type: "doc",
        date: "01/08/21",
        creators: ["long", "tram"],
      },
      {
        link: "https://docs.google.com/document/d/1MauND2uZ7cxqmU40F2Mlu6j-23ccQGOdQ8QGxRTpsAE/preview",
        nameFile: "BBHP_01_08_2021 ",
        type: "doc",
        date: "01/08/21",
        creators: ["luong", "han"],
      },
      {
        link: "https://drive.google.com/file/d/1hKsgjDvjLxbmDC3_issLQbqwvlAULcsl/preview",
        nameFile: "BBHP_01_08_2021 [ver2]",
        type: "pdf",
        date: "01/08/21",
        creators: ["luong", "han"],
      },
      {
        link: "https://drive.google.com/file/d/14RyMQJbLguPSChvciuWhwjtsJDrbizeA/preview",
        nameFile: "BBHP_01_08_2021 [ver1]",
        type: "pdf",
        date: "01/08/21",
        creators: ["luong", "han"],
      },
      {
        link: "https://drive.google.com/file/d/1eMTUGzf6fJLVGXphE6tR3kPFv9p1kTAu/preview",
        nameFile: "out1",
        type: "mp4",
        date: "07/08/21",
        creators: ["nghia", "dung"],
      },
      {
        link: "https://docs.google.com/document/d/161KJiSjpvPwhaRbD7-suoO8DJ4RcuB0Bjx9wHMOM39g/preview",
        nameFile: "Chọn phân cảnh quay",
        type: "doc",
        date: "07/08/21",
        creators: ["long", "tuan"],
      },
      {
        link: "https://drive.google.com/file/d/1aY8PWHxiCTAPRqsnDsTnJyvYMsZh-IyZ/preview",
        nameFile: "Sum",
        type: "mp4",
        date: "08/08/21",
        creators: ["sum"],
      },
      {
        link: "https://drive.google.com/file/d/1MXUX_elXsO1B4AlBwJxrmjN72HFOl0T8/preview",
        nameFile: "quang-phan-canh-4",
        type: "mp4",
        date: "07/08/21",
        creators: ["quang"],
      },
      {
        link: "https://drive.google.com/file/d/1E5t1PgSLgdgYc8qnhPv8BHRAb6_xQMi5/preview",
        nameFile: "LNN-Video",
        type: "mp4",
        date: "04/08/21",
        creators: ["nam"],
      },
      {
        link: "https://drive.google.com/file/d/1E5t1PgSLgdgYc8qnhPv8BHRAb6_xQMi5/preview",
        nameFile: "LNN-Video",
        type: "mp4",
        date: "04/08/21",
        creators: ["nam"],
      },
      {
        link: "https://drive.google.com/file/d/1OEGznwytZahpnhOwnRR4gOIlC1Nw3z5Z/preview",
        nameFile: "câu thoại",
        type: "mp4",
        date: "04/08/21",
        creators: ["han"],
      },
      {
        link: "https://drive.google.com/file/d/1-hyCdCPmePenwKrz8IkFEbz8VjowuddG/preview",
        nameFile: "cảnh gửi thông tin",
        type: "mp4",
        date: "04/08/21",
        creators: ["nam"],
      },
      {
        link: "https://drive.google.com/file/d/1pyjyTUZQy_VO9ogbopjwoBL4aaZW_50-/preview",
        nameFile: "Long",
        type: "mp4",
        date: "04/08/21",
        creators: ["long"],
      },
      {
        link: "https://drive.google.com/file/d/1v2m0JF66kkCm6RtwiFWZ_u9Bc_JcJjs9/preview",
        nameFile: "Trâm",
        type: "mp4",
        date: "04/08/21",
        creators: ["tram"],
      },
    ],
  },
  {
    nameFolder: "Tuần 3",
    linkFolder:
      "https://drive.google.com/drive/folders/1hQNIlUJTdbub1xkbAd2vQU4iSk7gjLi4",
    files: [
      {
        link: "https://docs.google.com/document/d/1_xyjeKXQWcC_w9_8O62LvFc0igfPki-B21UM-mJRLPQ/preview",
        nameFile: "BBHP_08/08/2021",
        type: "doc",
        date: "08/08/21",
        creators: ["tram", "luong"],
      },
    ],
  },
  {
    nameFolder: "Image",
    linkFolder:
      "https://drive.google.com/drive/folders/1XKmpAGV-PoU170slrp2nrMSuguoE827T",
    files: [
      {
        link: "https://drive.google.com/file/d/1eaoQCokvpIM6KN4SNDf1vFymSxHOmZIU/preview",
        nameFile: "phat",
        type: "jpg",
        date: "28/07/21",
        creators: ["phat"],
      },
      {
        link: "https://drive.google.com/file/d/1MEn3GPGCuMs9jF1oDU8pMWmPbcIi_Mz6/preview",
        nameFile: "Luong",
        type: "jpg",
        date: "27/07/21",
        creators: ["luong"],
      },
      {
        link: "https://drive.google.com/file/d/1RIqSTaRd4tKREGj0lgcp58PloH05uPzK/preview",
        nameFile: "Han",
        type: "jpg",
        date: "27/07/21",
        creators: ["han"],
      },
      {
        link: "https://drive.google.com/file/d/1yDEEwZYewXFYn-hULsvLPpC_GsrEoaeM/preview",
        nameFile: "Tuan",
        type: "jpg",
        date: "28/07/21",
        creators: ["tuan"],
      },
      {
        link: "https://drive.google.com/file/d/1k0dbSQnbjbIy1QiaSIPyahlQJ--9dT4c/preview",
        nameFile: "tram",
        type: "jpg",
        date: "27/07/21",
        creators: ["tram"],
      },
      {
        link: "https://drive.google.com/file/d/1nPrx-K-mR8v15SRETGqcWCMuSHWEaC-8/preview",
        nameFile: "nghia",
        type: "jpg",
        date: "27/07/21",
        creators: ["nghia"],
      },
      {
        link: "https://drive.google.com/file/d/12mWBIIlxCU39fiZt9MPtDQ7eosW5qwkK/preview",
        nameFile: "dung",
        type: "jpg",
        date: "27/07/21",
        creators: ["dung"],
      },
      {
        link: "https://drive.google.com/file/d/1F6MdI_RwkABhvgKn_bhozc0XwMtJH7eI/preview",
        nameFile: "quang",
        type: "jpg",
        date: "27/07/21",
        creators: ["quang"],
      },
      {
        link: "https://drive.google.com/file/d/1EPVltCtHf4aJ-eKjfhludNgPeNJUW9Re/preview",
        nameFile: "nam",
        type: "jpg",
        date: "27/07/21",
        creators: ["nam"],
      },
      {
        link: "https://drive.google.com/file/d/1xK6MmHQP4F89gHsVzUXSXVR9UP2th-h1/preview",
        nameFile: "sum",
        type: "jpg",
        date: "27/07/21",
        creators: ["sum"],
      },
      {
        link: "https://drive.google.com/file/d/17gc6zT7RLjBIWXThcXzKF5TzZzC7PKye/preview",
        nameFile: "long",
        type: "jpg",
        date: "27/07/21",
        creators: ["long"],
      },
    ],
  },
  {
    nameFolder: "HĐTLN",
    linkFolder:
      "https://drive.google.com/drive/folders/1hr2oQF33ErlzwkVaqP6TwinqDwdGNq84",
    files: [
      {
        link: "https://drive.google.com/file/d/1i3s8PGjShaMvJTTj_jkPORlf7WGABYiM/preview",
        nameFile: "HOPDONGTHANHLAPNHOM",
        type: "pdf",
        date: "26/07/21",
        creators: ["han", "luong", "long", "nghia", "sum"],
      },
      {
        link: "https://drive.google.com/file/d/1phxR6KIBN_HQ5PEQ9upvH2sU5eSygG83/preview",
        nameFile: "HOPDONGTHANHLAPNHOM_V2",
        type: "pdf",
        date: "26/07/21",
        creators: ["long", "tram"],
      },
    ],
  },
];

const iconFileMap = {
  doc: '<i class="fas file-icon fa-file-word"></i>',
  pdf: `<i class="fas file-icon fa-file-pdf"></i>`,
  mp4: `<i class="fas fa-file-video"></i>`,
  xlsx: `<i class="fas fa-file-excel"></i>`,
  txt: `<i class="fas fa-file-alt"></i>`,
  jpg: `<i class="fas fa-file-image"></i>`,
};

const nameSpinned = $(".file-name-spinned-top");

// Handle render tab-content
const tabContent = $(".tab-content");
tabContent.innerHTML = dataDocument
  .map(
    (folder) => `
    <div class="tab-pane">
    <div class="link-drive-wrapper">
    <a class="link-drive" target="_blank" href=${folder.linkFolder}> ${folder.nameFolder} <i class="link-drive-icon fas fa-external-link-square-alt"></i> </a> 
    <a class="link-drive link-drive--all" target="_blank" href="https://drive.google.com/drive/folders/1DF6k3GiINt19hrq1YngoZ4S0tQKo26w5"> drive <i class="link-drive-icon fas fa-external-link-square-alt"></i> </a> 
    </div>
      <ul class="list-files">
      </ul>
    </div>`
  )
  .join(" ");

const allListFiles = $$(".list-files");
allListFiles.forEach((listFiles, index) => {
  listFiles.innerHTML = dataDocument[index].files
    .map(
      (file) => `
    <li class="file-item">
    <label for="file-checkbox" class="file-infor">
        ${iconFileMap[file.type]}
        <span class="file-name">${file.nameFile}</span>
    </label>

    <div class="file-detail">
        <span class="file-date">
            ${file.date}
        </span>
        <div class="file-creators">
            ${file.creators.map(
              (nameCreator) => `
            <div class="creator-img" style="background-image: url(${
              dataMembers[mapDataMembers.indexOf(nameCreator)].image
            });">
                <span class="creator-img-name">${
                  dataMembers[mapDataMembers.indexOf(nameCreator)].name
                    .split(" ")
                    .slice(-1)[0]
                }</span>
            </div>
            `
            )}
        </div>
    </div>
</li>
    `
    )
    .join(" ");
});

// Handle Tabs
const tabsWrapper = $(".tabs");
tabsWrapper.innerHTML =
  dataDocument
    .map(
      (document) => `
    <div class="tab-item">
    <i class="fas fa-folder"></i>
    ${document.nameFolder}
    </div>
    `
    )
    .join(" ") + `<div class="line"></div>`;

const tabs = $$(".tab-item");
tabs[0].classList.add("active");
tabs[0].querySelector("i").classList.add("fa-folder-open");
tabs[0].querySelector("i").classList.remove("fa-folder");
const panes = $$(".tab-pane");
panes[0].classList.add("active");
const tabActive = $(".tab-item.active");
const line = $(".tabs .line");
line.style.left = tabActive.offsetLeft + "px";
line.style.width = tabActive.offsetWidth + "px";

// Handle frame ( display files )
const framesWrapper = $(".frames-wrapper");
var currentFolder = 0;

const handleChangeFolder = () => {
  framesWrapper.innerHTML = dataDocument[currentFolder].files
    .map(
      (file) => `<iframe class="display-file"
                  src=${file.link}>
              </iframe>`
    )
    .join(" ");
  frames = $$("iframe");
  fileInfors = allListFiles[currentFolder].querySelectorAll(".file-infor");
  handleOpenFrame();
};

var doit;
window.onresize = () => {
  clearTimeout(doit);
  doit = setTimeout(() => {
    line.style.left = tabs[currentFolder].offsetLeft + "px";
    line.style.width = tabs[currentFolder].offsetWidth + "px";
  }, 200);
};

tabs.forEach((tab, index) => {
  const pane = panes[index];

  tab.onclick = function () {
    currentFolder = index;
    handleChangeFolder();

    if ($(".tab-item.active") !== tab) {
      line.style.left = this.offsetLeft + "px";
      line.style.width = this.offsetWidth + "px";
      $(".tab-item.active")
        .querySelector("i")
        .classList.remove("fa-folder-open");
      $(".tab-item.active").querySelector("i").classList.add("fa-folder");
      $(".tab-item.active").classList.remove("active");
      $(".tab-pane.active").classList.remove("active");

      this.classList.add("active");
      pane.classList.add("active");
      this.querySelector("i").classList.remove("fa-folder");
      this.querySelector("i").classList.add("fa-folder-open");
    }
  };
});

handleChangeFolder();

var currentIndex = 0;

var frames = document.querySelectorAll("iframe");
const names = document.querySelectorAll(".file-name");

const handleFrame = () => {
  frames.forEach((frame, index) => {
    if (index === currentIndex) {
      frame.style.display = "block";
    } else frame.style.display = "none";
  });
  // nameSpinned.innerHTML = names[currentIndex].innerText;
  const currentFile = dataDocument[currentFolder].files[currentIndex];
  $(".file-spinned-top-icon").innerHTML = iconFileMap[currentFile.type];
  $(".file-spinned-top-name").innerHTML =
    currentFile.nameFile + "." + currentFile.type;
  handleCheckBtnDisplay();
};

const handleCheckBtnDisplay = () => {
  if (currentIndex === frames.length - 1) btnNext.style.display = "none";
  else btnNext.style.display = "flex";
  if (currentIndex === 0) btnPrev.style.display = "none";
  else btnPrev.style.display = "flex";
};

var fileInfors = allListFiles[currentFolder].querySelectorAll(".file-infor");
function handleOpenFrame() {
  fileInfors.forEach((element, index) => {
    element.onclick = () => {
      currentIndex = index;
      handleFrame();
    };
  });
}
handleOpenFrame();

const btnNext = document.querySelector(".next-btn");
const btnPrev = document.querySelector(".prev-btn");

btnNext.onclick = () => {
  if (currentIndex < frames.length - 1) currentIndex++;
  handleFrame();
};

btnPrev.onclick = () => {
  if (currentIndex > 0) currentIndex--;
  handleFrame();
};
